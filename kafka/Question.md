# 설계 관련
##  DB Lock 전략
### 1️⃣ 상황 설명
- 중고거래 도메인이라 대부분의 상품이 1개 단위로 게시됩니다.
- 결제 수단 입력 단계에서부터 락을 걸면 동시성 병목이 우려됩니다.
- 티케팅처럼 ‘선결제 → 실패 시 일괄 취소’ 방식은 Kafka 트랜잭션/보상 흐름 설계 난이도가 높아, 초기 도입 리스크가 있습니다.
### 2️⃣ 목표
- 과도한 락이나 타임아웃 없이, 단일 상품의 동시 구매 충돌을 안전하게 방지하고 싶습니다.
### 3️⃣ 질문
- 락의 시점을 고민중인데, 주문 검증 단계에서 진행을 해야 되는지 결제 확정 시점에 낙관적 락을 거는게 적절한 지 고민중입니다.
- 콘서트 티켓팅같은 경우에는 2번이 적용된 것을 경험했는데, 중고 거래 특성 상 이정도의 트래픽이 몰릴 것으로 예상이 되지 않아서 1번이 적절하다고 생각되지만 멘토님의 의견을 여쭤보고 싶습니다.

---
## 모놀리식 모듈러 설계 개발 중 API Gateway 라우팅 방향성
API Gateway에서 요청 URI를 저장하고 재요청하는 방식이 일반적인 패턴인지, 아니면 URI-서비스 매핑을 별도로 관리하는 것이 좋은지 조언 부탁드립니다.

레디스로 캐싱을 고려 중에 있습니다. 일반적으로 조회할 때 캐싱을 이용해서 성능 향상을 주는걸로 알고 있습니다. 현재 모듈별로 DB를 나누고 있는 상황에서, Redis도 분리를 하게 되면, 캐싱전략 난이도가 높을 것 같은데, 단일 Redis로 운용해도 괜찮을까요? 앞으로 MSA로 확장을 고려할 텐데, 원칙에 어긋나지는 않을까요?

설계 단계에서 제가 놓치기 쉬운 구조적 부족 부분(확장성, 장애 처리, 트랜잭션 처리 등)에 대한 피드백을 받고 싶습니다.

---
## 코레오그래피/오케스트레이션 패턴 관련
### 1️⃣ 상황 설명
- 개발 기간이 약 한 달 반으로 짧은 상황입니다.
- Kafka 기반의 SAGA 패턴을 도입하려 하는데, 오케스트레이션 방식과 코레오그래피 방식 중 어떤 접근이 현실적인지 고민 중입니다.
- 오케스트레이션은 중앙에서 흐름을 제어하므로 안정적이지만, 단일 장애 지점(SPOF)과 운영 비용, 확장성 제약이 우려됩니다.
- 반면 코레오그래피는 확장성과 비동기 성능이 좋지만, 보상 트랜잭션 처리나 장애 추적이 복잡해 운영 난이도가 높다고 알고 있습니다.
### 2️⃣ 목표
- 제한된 기간 안에 완성도와 안정성을 확보할 수 있는 SAGA 구현 방식을 선택하고자 합니다.
- 초기엔 단순하고 명확한 구조를 유지하면서도, 추후 확장성과 유지보수성을 고려한 방향으로 설계하고 싶습니다.
### 3️⃣ 질문
1. 짧은 개발 기간(약 한 달 반) 내에서 Kafka 기반 SAGA를 구현할 때, 오케스트레이션과 코레오그래피 중 어느 방식이 더 현실적인 선택일까요?
2. 실무에서는 두 방식을 혼합해 사용하는 경우가 있다고 들었습니다.
    - 어떤 기준으로 “이 부분은 오케스트레이션, 이 부분은 코레오그래피”로 구분하시는지 궁금합니다.
    - 이런 하이브리드 구조를 적용할 경우, 운영 복잡도나 개발 기간이 실제로 얼마나 늘어나는지도 알고 싶습니다.
3. 현실적으로는 MVP 단계에서 오케스트레이션으로 먼저 구현하고, 이후 일부 기능만 코레오그래피로 전환하는 접근이 괜찮을까요?
4. Kafka 운영 시 노드 수나 파티션 개수를 결정하는 일반적인 기준이 있다면 알고 싶습니다.
   
    (예: 서비스 수, 트래픽, 메시지 처리량 등을 기준으로 산정하는 방식 등)

---
## API Gateway 인증 방식

MSA를 염두해 둔 상황에서, 모놀리식 모듈러로 개발하고 있습니다. 스프링 시큐리티를 사용해서 인증 후 헤더에 JWT 토큰으로 내부 식별하려고 하는데, 인증을 API 게이트웨이에서 처리하는건지. 인증/인가 모듈을 구성해서 라우팅을 시키게 하는건지 궁금합니다.

스프링 시큐리티를 이용해서 인증 후 JWT 토큰을 헤더에 담아 내부 서비스 식별에 사용하려고 하는데요,

일반적으로 **인증 처리를 API 게이트웨이 단에서 담당하는지**,

아니면 **인증/인가 모듈을 별도로 두고 내부 라우팅을 통해 인증을 거치는 방식**을 사용하는지가 궁금합니다.

또, 게이트웨이가 인증 로직을 많이 가져가게 되면 **결합도가 높아지거나 서비스 확장성이 떨어질 위험**이 있을 것 같은데,

이런 구조적 트레이드오프에 대해서는 어떤 기준으로 판단하시는지도 궁금합니다.

실제 운영 환경에서는 이 부분을 어떻게 설계하는 게 좋을지 멘토님 의견을 듣고 싶습니다.

---

## MSA 환경에서 타 도메인 데이터 의존성 관리 관련
### 1️⃣ 상황 설명
- MSA 구조에서 각 서비스가 자신의 데이터만 관리하도록 설계하고 있습니다.
- 하지만 실제 개발 중에는, 다른 도메인에 속한 정보(예: 상품 이미지, 회원 닉네임, 결제 수단 등)를 한 서비스에서 함께 보여줘야 하는 경우가 자주 발생합니다.
- 이때 매번 API 호출로 가져오면 네트워크 비용과 장애 전파 위험이 생기고, 반대로 데이터를 복제해 두면 정합성 유지와 데이터 중복 문제가 발생합니다.
### 2️⃣ 목표
- 도메인 간 의존도를 최소화하면서도, 필요한 정보를 효율적이고 안정적으로 조회할 수 있는 구조를 설계하고 싶습니다.
### 3️⃣ 질문
1. 실무에서는 다른 도메인의 데이터를 어디까지 로컬에 복제(저장) 하는 것이 적절하다고 보시나요?
2. 예를 들어 `OrderItem`에 상품 이미지나 이름을 함께 저장하는 것처럼, 조회 전용 필드를 갖는 패턴은 어느 정도까지 허용되는 편인가요?
3. 이런 의사결정을 내릴 때 도메인 경계 기준이나 데이터 복제가 어디까지 허용되는지에 대 판단 기준이 있다면 알고 싶습니다.

---
## 엘라스틱 서치 조회 방법
- es만 사용하는 방법 VS es에서 id 조회 후 rdb에서 상세조회 하는 방법
    - es만 사용
        - 빠른 속도
        - 정합성 문제(이벤트 발행해서 동기화 -> 최종적 일관성)
        - 조회하려는 모든 데이터가 전부 es에 저장되어야 함.
    - es + rdb
        - 상대적으로 느린 속도
        - 데이터 일관성 보장
        - es에는 조회 관련 데이터만 저장.
    - 고민
        - 속도 → 두 경우 모두 빠름
        - 정합성 → 상품 검색이므로 결과적 일관성으로 충분
        - 데이터 저장량 → 현재 상품 구조 상, 대부분의 데이터가 조회에 필요함(비슷)
    - 질문 : 어떤 선택을 해야할지, 실무에서는 주로 어떤 방식을 사용하는지 궁금합니다.
  
---
# 기술/스택 관련
## 카프카 접근 방식
### 1️⃣ 상황 설명
- 대부분의 서비스가 Kafka로 통신하도록 설계되어 있습니다.
- 다만, 서비스별로 동기/비동기 처리의 구분 기준이 명확하지 않습니다. 예를 들어 주문 시 상품 정보를 불러오는 경우, 이를 Kafka 이벤트로 처리할지, API 요청으로 처리할지 구분하는 기준이 애매합니다.
- 또한 Kafka 운영 시, 노드 수·파티션 개수 산정 기준에 대한 경험적 감이 부족합니다.
### 2️⃣ 목표
- Kafka 운영 규모(노드·파티션 수)와 서비스 간 통신 기준(API vs Kafka) 을 명확히 정의해, 현실적인 운영 전략을 세우고 싶습니다.
### 3️⃣ 질문
1. Kafka 운영 시 노드 수나 파티션 개수를 결정하는 일반적인 기준이 있을까요?

   (예: 서비스 수, 트래픽, 메시지 처리량 등을 기준으로 산정하는 방식 등)
2. 서비스 간 통신 시, Kafka 이벤트 처리와 API 호출은 어떤 기준으로 구분하는 것이 실무적으로 적절한가요?
    - 단순 조회나 검증은 API, 상태 변경이나 비동기 처리는 Kafka로 나누는 방식이 일반적인가요?
3. 마지막으로, **DLQ(Dead Letter Queue)는 실무에서 주로 어떤 방식으로 처리**하시나요?
    - 수동 재처리 위주인지, 자동 재시도나 별도 알림 체계를 두는지도 궁금합니다.

---
# 운영 관련
## 로그 수집 분석 방식과 장애 대응

서비스들이 모듈 별로 나뉘어져 있습니다. 여기서 어떻게 로그를 관리하고 추적하는 방식에 대해 궁금합니다, MSA로 바뀌게 될 때는 추가로 고려해야할 것이 있을까요?

한 개의 요청이 여러 모듈을 타다 보니, 모듈 별로 로그를 기록하면, 추적이 어려울 것 같아 보입니다.  그리고 실무에서 흔히 발생하는 장애들과 대응 방법들에 대해서 알고 싶습니다.

## 메모리 누수 원인

실무에서 메모리 누수에 대한 이슈를 들었습니다. 누수가 왜 일어나는지, 그리고 누수를 확인하는 방법과 해결하는 방법들에 대해 알고 싶습니다.